<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>üí≥ Pagos - Admin</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css"></script>
</head>
<body class="bg-light p-4">

  <div class="container">
    <h2 class="text-success mb-4"><i class="bi bi-credit-card"></i> Historial de Pagos</h2>

    <div class="table-responsive">
      <table class="table table-bordered table-hover table-striped align-middle">
        <thead class="table-success">
          <tr>
            <th>Cliente</th>
            <th>Email</th>
            <th>Monto</th>
            <th>M√©todo</th>
            <th>Fecha</th>
            <th>Orden</th>
          </tr>
        </thead>
        <tbody id="tablaPagos"></tbody>
      </table>
    </div>
  </div>

  <script>
    const token = localStorage.getItem('token');

    fetch('/api/pagos', {
      headers: { Authorization: token }
    })
    .then(res => res.json())
    .then(data => {
      console.log('üì¶ Pagos cargados:', data);
      const tbody = document.getElementById('tablaPagos');
      data.forEach(pago => {
        const fila = document.createElement('tr');
        fila.innerHTML = `
          <td>${pago.usuario?.nombre || '-'}</td>
          <td>${pago.usuario?.email || '-'}</td>
          <td><strong>S/ ${pago.total.toFixed(2)}</strong></td>
          <td>${pago.metodo}</td>
          <td>${new Date(pago.fecha).toLocaleString()}</td>
          <td>${pago.orden?._id || 'N/A'}<br><span class="badge bg-info">${pago.orden?.estado || '-'}</span></td>
        `;
        tbody.appendChild(fila);
      });
    })
    .catch(err => {
      console.error(err);
      alert('‚ùå Error al cargar los pagos');
    });
  </script>

</body>
</html>
